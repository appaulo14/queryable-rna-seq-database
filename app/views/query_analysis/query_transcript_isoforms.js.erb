jQuery(document).ready(function($) {
//   $().ajaxStart(function(){
//     $('body').css('cursor', 'wait');
//   });
// 
//   $().ajaxStop(function(){
//     $('body').css('cursor', 'auto');
//   });
  $('#query_transcript_isoforms_dataset_id').change(dataset_id_pair_changed);
  //$('#submit_button').click(goat);
  $( "#new_query_transcript_isoforms" ).on( "submit", function( event ) {
    event.preventDefault();
    $('#submit_button').val('Querying....');
    $('#submit_button').attr("disabled", "disabled");
    goat();
  });
});
ppiece = 0;
function goat(piece){
  if ( ! piece){
    piece = 0;
  }
  ppiece = piece;
  //alert('Piece =' + piece);
  params = $("#new_query_transcript_isoforms").serializeArray();
  params.push({ name: "query_transcript_isoforms[piece]", value: piece });
  //$('body').css('cursor', 'progress');
  $.post('query_transcript_isoforms',
       params
  ).done(success)
  .fail(post_failed);
  //.always(function() {$('body').css('cursor', 'auto');});
//   $.get('get_query_transcript_isoforms_piece',
//          $("#new_query_transcript_isoforms").serialize()
//         ).done(success)
//          .fail(post_failed)
//          .always(function() { alert("finished"); });
}

function success(html){
  //alert('success');
  tbody = $('#insert_query_results_here');
  tbody.append(html);
  if (html.length > 0){
    goat(ppiece+1);
  }
  else{
    $('#submit_button').removeAttr("disabled");
    $('#submit_button').val('Query');
  }
}

function post_failed(){
  //alert('fail');
}

function dataset_id_pair_changed(){
  dataset_id = $('#query_transcript_isoforms_dataset_id').val();
  request_string = 'get_transcript_isoforms_samples_for_dataset' +
                   '?dataset_id=' + dataset_id
  $.get(request_string, replace_sample_cmps);
}

function replace_sample_cmps(html){
  $('#sample_comparisons_container').html(html);
}

